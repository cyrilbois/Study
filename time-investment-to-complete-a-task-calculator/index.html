<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index,follow" />
    <meta name="author" content="Radu Bulai" />
    <title>Time to Complete a Task App</title>
    <link rel="canonical" href="/" />
    <meta
      name="description"
      content="Calculate the amount of time needed (in hours per day) in order to complete a task in a certain amount of time."
    />
    <!-- Bootstrap CSS from https://getbootstrap.com/docs/4.5/getting-started/introduction/ -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <!-- Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
      crossorigin="anonymous"
    ></script>
    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Custom Styles -->
    <style>
      /* Utilities */
      :root {
        --primary-color: hsl(211, 91%, 49%);
        --primary-color-lighten: hsl(211, 89%, 56%);
        --background-color: #fefefe;
        --background-color-secondary: #fff;
        --font-main-color: hsl(210, 11%, 10%);
      }
      [data-theme="dark"] {
        --background-color: #0b1014;
        --background-color-secondary: #121a20;
        --font-main-color: #fff;
      }
      ::selection {
        background: var(--primary-color);
        color: #fff;
      }
      html {
        height: 100%;
      }
      body {
        /* useful for sticking the footer to bottom of page */
        min-height: 100%;
        display: flex;
        flex-direction: column;
        color: var(--font-main-color);
        background-color: var(--background-color);
        transition: background-color 200ms ease-in;
      }
      .modal-content {
        background-color: var(--background-color);
      }
      .table {
        color: var(--font-main-color);
      }
      /* Dark mode toggle */
      .toggle-dark-mode {
        position: relative;
        margin-left: 1em;
      }
      .toggle-dark-mode input[type="checkbox"] {
        width: 1.5em;
        height: 1.5em;
        opacity: 0;
        cursor: pointer;
      }
      .toggle-dark-mode input[type="checkbox"] ~ .dark-mode-icon::before {
        content: "\f186";
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
        font-size: 1.7rem;
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        color: #fff;
      }
      .toggle-dark-mode
        input[type="checkbox"]:checked
        ~ .dark-mode-icon::before {
        content: "\f185";
      }
    </style>
  </head>
  <body>
    <div class="container mt-3">
      <h1>Time Investment to Complete a Task Calculator</h1>
      <p>
        Find the amount of time needed (in hours per day) in order to complete a
        task in a certain amount of time.
      </p>
      <form>
        <div class="form-group">
          <label for="taskNameInput">Task Name</label>
          <input type="text" class="form-control" id="taskNameInput" />
        </div>
        <div class="d-flex" style="gap: 1rem">
          <div class="form-group w-100">
            <label for="estimatedHoursInput"
              >Estimated Hours for Task Completion</label
            >
            <input
              type="number"
              class="form-control"
              id="estimatedHoursInput"
            />
          </div>
          <div class="form-group w-100">
            <label for="desiredTimeInput">Desired Time to Complete</label>
            <div class="input-group">
              <input type="number" class="form-control" id="desiredTimeInput" />
              <div class="input-group-append">
                <select class="custom-select" id="desiredTimeUnit">
                  <option value="days">days</option>
                  <option value="weeks">weeks</option>
                  <option value="months">months</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <button
          type="submit"
          class="btn btn-primary"
          onclick="calculateHoursPerDay(event);"
        >
          Calculate
        </button>
      </form>
      <div id="outputContainer" class="mt-3">
        <!-- Output will be displayed here -->
      </div>
      <div id="outputTable" class="mt-3">
        <!-- Output list will be displayed here -->
      </div>
      <div id="exportOrImportList">
        <a
          href="#"
          title="Export List as JSON"
          onclick="exportListAsJSON()"
          class="mr-3"
          >Export List</a
        >
        <!-- <a
          href="#"
          title="Import List as JSON"
          onclick="importListAsJSON(event)"
          >Import List</a
        > -->
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-3 mt-auto">
      <div class="container text-center">
        <div class="d-flex justify-content-center align-items-center">
          <div class="mt-2" title="See the code on GitHub">
            <a
              href="https://github.com/radualexandrub/Study/tree/master/time-investment-to-complete-a-task-calculator"
              target="_blank"
              ><i class="fab fa-github fa-2x"></i
            ></a>
          </div>
          <div class="toggle-dark-mode">
            <input
              type="checkbox"
              id="toggleDarkMode"
              title="Toggle between light and dark theme"
            />
            <span class="dark-mode-icon"></span>
          </div>
        </div>
        <p class="m-0 mt-2">Made with Bootstrap CSS &amp; Vanilla JS</p>
        <p class="m-0 mt-2">
          Copyright 2023 Â©
          <a target="_blank" href="https://radubulai.com/">Radu-Alexandru B.</a>
        </p>
      </div>
    </footer>
    <!-- End of Footer -->

    <!-- Edit Modal -->
    <div
      class="modal fade"
      id="taskEditModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="taskEditModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <p class="modal-title font-weight-bold" id="taskEditModalLabel">
              Edit task
            </p>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
              title="Close Edit Modal"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="taskNameInputEdit">Task Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="taskNameInputEdit"
                />
              </div>
              <div class="d-flex" style="gap: 1rem">
                <div class="form-group w-100">
                  <label for="estimatedHoursInputEdit"
                    >Estimated Hours to Complete</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="estimatedHoursInputEdit"
                  />
                </div>
                <div class="form-group w-100">
                  <label for="desiredTimeInputEdit"
                    >Desired Time to Complete</label
                  >
                  <div class="input-group">
                    <input
                      type="number"
                      class="form-control"
                      id="desiredTimeInputEdit"
                    />
                    <div class="input-group-append">
                      <select class="custom-select" id="desiredTimeUnitEdit">
                        <option value="days">days</option>
                        <option value="weeks">weeks</option>
                        <option value="months">months</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="editCalculation(event, 'saveTask')"
            >
              Save changes
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End of Edit Modal -->
  </body>

  <script>
    var calculationList = []; // Initialize an empty array to store the calculations

    // Check if the calculationList array is stored in local storage
    if (localStorage.getItem("calculationList")) {
      // If it is, retrieve it from local storage
      calculationList = JSON.parse(localStorage.getItem("calculationList"));
      displayCalculationList();
    }

    function getFormattedDate(dateString, showDayOfWeek = false) {
      let dateObject = new Date(dateString);
      let year = dateObject.getFullYear();
      const months = [
        "Jan",
        "Feb",
        "Mar",
        "Apr",
        "May",
        "Jun",
        "Jul",
        "Aug",
        "Sep",
        "Oct",
        "Nov",
        "Dec",
      ];
      let month = months[dateObject.getMonth()];
      let day = dateObject.getDate().toString().padStart(2, "0");

      if (showDayOfWeek) {
        let dayNames = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ];
        const dayOfWeek = dayNames[dateObject.getDay()];
        return dayOfWeek + ", " + day + "-" + month + "-" + year;
      }

      return day + "-" + month + "-" + year;
    }

    function calculateHoursPerDay(event) {
      // Prevent the form from being submitted
      event.preventDefault();

      // Get the values of the input fields and dropdown menu
      var taskName = document.getElementById("taskNameInput").value;
      var estimatedHours = document.getElementById("estimatedHoursInput").value;
      var desiredTimeInDays = document.getElementById("desiredTimeInput").value;
      var desiredTimeUnit = document.getElementById("desiredTimeUnit").value;

      if (!(taskName && estimatedHours && desiredTimeInDays)) {
        document.getElementById("outputContainer").innerHTML =
          '<p class="text-danger">Please make sure that all the inputs are not empty.</p>';
        return;
      }

      // Convert the desired time to days if necessary
      if (desiredTimeUnit === "weeks") {
        desiredTimeInDays *= 7;
      } else if (desiredTimeUnit === "months") {
        desiredTimeInDays *= 30;
      }

      // Calculate the End Date (Deadline)
      var addDate = new Date();
      var endDate = new Date();
      endDate.setDate(addDate.getDate() + parseInt(desiredTimeInDays));

      // Perform the calculation
      var hoursPerDay = estimatedHours / desiredTimeInDays;

      // Save the input and output in an object
      var calculation = {
        taskId: Math.random().toString(16).slice(2),
        taskName: taskName,
        estimatedHours: estimatedHours,
        desiredTime: desiredTimeInDays,
        desiredTimeUnit: desiredTimeUnit,
        hoursPerDay: hoursPerDay,
        addDate: addDate,
        endDate: endDate,
      };

      // Add the calculation object to the list
      calculationList.push(calculation);

      // Save the updated calculationList array to local storage
      localStorage.setItem("calculationList", JSON.stringify(calculationList));

      // Update the inner HTML of the output container
      document.getElementById("outputContainer").innerHTML =
        '<p>To complete the task "' +
        taskName +
        '" in ' +
        desiredTimeInDays +
        " days" +
        " (i.e. " +
        (calculation.desiredTime / 30).toFixed(2) +
        " months), you need to invest " +
        hoursPerDay.toFixed(2) +
        " hours per day.</p>";

      // Display the updated calculation list
      displayCalculationList();
    }

    function deleteCalculation(index) {
      // Remove the calculation at the given index from the calculationList array
      calculationList.splice(index, 1);

      // Save the updated calculationList array to local storage
      localStorage.setItem("calculationList", JSON.stringify(calculationList));

      // Display the updated calculation list
      displayCalculationList();
    }

    let taskIdToEdit;
    let taskFound;
    let taskFoundIndex;
    function editCalculation(event, action) {
      if (action === "openModal") {
        // Retrieve Selected Task to Edit
        taskIdToEdit =
          event.target.parentElement.parentElement.getAttribute("data-key");
        taskFound = calculationList.find(
          (task) => task.taskId === taskIdToEdit
        );
        taskFoundIndex = calculationList.findIndex(
          (task) => task.taskId === taskIdToEdit
        );

        // Populate Modal with Current Task Information
        document.getElementById("taskNameInputEdit").value = taskFound.taskName;
        document.getElementById("estimatedHoursInputEdit").value =
          taskFound.estimatedHours;
        document.getElementById("desiredTimeInputEdit").value =
          taskFound.desiredTime;
        document.getElementById("desiredTimeUnitEdit").value = "days";
      } else if (action === "saveTask") {
        // Get new Task Information
        let taskNewName = document.getElementById("taskNameInputEdit").value;
        let taskNewEstimatedHours = document.getElementById(
          "estimatedHoursInputEdit"
        ).value;
        let taskNewDesiredTimeInDays = document.getElementById(
          "desiredTimeInputEdit"
        ).value;
        let taskNewDesiredTimeUnit = document.getElementById(
          "desiredTimeUnitEdit"
        ).value;

        // Update Task Information
        {
          // Update Task New Name and New Estimated Hourds
          calculationList[taskFoundIndex].taskName = taskNewName;
          calculationList[taskFoundIndex].estimatedHours =
            taskNewEstimatedHours;

          // Convert the desired time to days if necessary
          // and Update Task New Desired Time in Days
          if (taskNewDesiredTimeUnit === "weeks") {
            taskNewDesiredTimeInDays *= 7;
          } else if (taskNewDesiredTimeUnit === "months") {
            taskNewDesiredTimeInDays *= 30;
          }
          calculationList[taskFoundIndex].desiredTime =
            taskNewDesiredTimeInDays;

          // Update Task New Date and End Date
          let newAddDate = new Date();
          let newEndDate = new Date();
          newEndDate.setDate(
            newAddDate.getDate() + parseInt(taskNewDesiredTimeInDays)
          );
          calculationList[taskFoundIndex].addDate = newAddDate;
          calculationList[taskFoundIndex].endDate = newEndDate;

          // Perform the calculation and Update Task New Hours per Day
          let newHoursPerDay = taskNewEstimatedHours / taskNewDesiredTimeInDays;
          calculationList[taskFoundIndex].hoursPerDay = newHoursPerDay;
        }

        // Save & Display the updated calculationList array to local storage
        localStorage.setItem(
          "calculationList",
          JSON.stringify(calculationList)
        );
        displayCalculationList();
      }
    }

    function displayCalculationList() {
      // Clear the output container
      document.getElementById("outputTable").innerHTML = "";

      // Check if the calculationList array is empty
      if (calculationList.length === 0) {
        // If it is, display a message
        document.getElementById("outputTable").innerHTML =
          "<p>No calculations to display.</p>";
      } else {
        // If it is not, construct the HTML for the table
        var tableHTML = '<div class="table-responsive">';
        tableHTML += '<table class="table">';
        tableHTML += "<thead>";
        tableHTML += "<tr>";
        tableHTML += '<th scope="col">#</th>';
        tableHTML += '<th scope="col">Task Name</th>';
        tableHTML +=
          '<th scope="col" title="Estimated hours for task completion">Estimated Hours</th>';
        tableHTML +=
          '<th scope="col" title="Desired time to complete the task">Desired Time</th>';
        tableHTML +=
          '<th scope="col" title="Time needed to be invested in hours per day">Hours per Day</th>';
        tableHTML +=
          '<th scope="col" title="Add/Last updated Date">Add/Update Date</th>';
        tableHTML +=
          '<th scope="col" title="Possible end date for task completion">End Date</th>';
        tableHTML += '<th scope="col"></th>';
        tableHTML += '<th scope="col"></th>';
        tableHTML += "</tr>";
        tableHTML += "</thead>";
        tableHTML += "<tbody>";

        // Iterate over the calculationList array
        for (var i = 0; i < calculationList.length; i++) {
          // Get the current calculation
          var calculation = calculationList[i];

          // Construct the HTML for the calculation
          tableHTML += `<tr data-key=${calculation.taskId}>`;
          tableHTML += '<th scope="row">' + (i + 1) + "</th>";
          tableHTML += "<td>" + calculation.taskName + "</td>";
          tableHTML += "<td>" + calculation.estimatedHours + "</td>";
          tableHTML +=
            "<td>" +
            calculation.desiredTime +
            " days" +
            " (" +
            (calculation.desiredTime / 30).toFixed(2) +
            " months)</td>";
          tableHTML += `<td title="${(calculation.hoursPerDay * 60).toFixed(
            0
          )} minutes">${calculation.hoursPerDay.toFixed(2)}</td>`;
          tableHTML += `<td title="${getFormattedDate(
            calculation.addDate,
            true
          )}">${getFormattedDate(calculation.addDate)}</td>`;
          tableHTML += `<td title="${getFormattedDate(
            calculation.endDate,
            true
          )}">${getFormattedDate(calculation.endDate)}</td>`;
          tableHTML += `<td><button type="button" class="btn btn-secondary edit-button" data-toggle="modal" data-target="#taskEditModal"
            onclick="editCalculation(event, 'openModal')" title="Edit this task">Edit</button></td>`;
          tableHTML += `<td><button type="button" class="btn btn-danger delete-button"
            onclick="deleteCalculation(${i})" title="Delete this task">X</button></td>`;
          tableHTML += "</tr>";
        }

        // Close the table HTML
        tableHTML += "</tbody>";
        tableHTML += "</table>";

        // Add the table HTML to the output container
        document.getElementById("outputTable").innerHTML = tableHTML;
      }
    }

    /* Export and Import Tasks List as JSON */
    function exportListAsJSON() {
      // https://stackoverflow.com/questions/33780271/export-a-json-object-to-a-text-file
      const filename = `TasksList_${new Date()
        .toISOString()
        .slice(0, 10)}.json`;
      const jsonStr = JSON.stringify(calculationList);

      let element = document.createElement("a");
      element.setAttribute(
        "href",
        "data:text/plain;charset=utf-8," + encodeURIComponent(jsonStr)
      );
      element.setAttribute("download", filename);

      element.style.display = "none";
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
    }

    /* Dark Mode */
    const checkboxDarkTheme = document.getElementById("toggleDarkMode");
    const currentTheme = localStorage.getItem("theme")
      ? localStorage.getItem("theme")
      : null;
    if (currentTheme) {
      document.documentElement.setAttribute("data-theme", currentTheme);
      if (currentTheme === "dark") {
        checkboxDarkTheme.checked = true;
      }
    }

    checkboxDarkTheme.addEventListener("change", toggleDarkTheme);
    function toggleDarkTheme(e) {
      if (e.target.checked) {
        document.documentElement.setAttribute("data-theme", "dark");
        localStorage.setItem("theme", "dark");
      } else {
        document.documentElement.setAttribute("data-theme", "light");
        localStorage.setItem("theme", "light");
      }
    }
  </script>
</html>
